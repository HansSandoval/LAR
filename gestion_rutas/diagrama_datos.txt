
╔════════════════════════════════════════════════════════════════════════════╗
║                    🗄️  ESTRUCTURA DE BASE DE DATOS                        ║
╚════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│  ALMACENAMIENTO EN DISCO                                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  c:\Users\hanss\Desktop\LAR\                                            │
│  └── gestion_rutas\                                                        │
│      ├── gestion_rutas.db  ⭐ ← AQUÍ ESTÁN LOS 503 REGISTROS              │
│      │   │                                                                  │
│      │   ├── Tabla: zona (1 registro)                                      │
│      │   │   ├── id_zona: 1                                                │
│      │   │   ├── nombre: "Zona Prueba LSTM"                                │
│      │   │   └── ...                                                       │
│      │   │                                                                  │
│      │   └── Tabla: prediccion_demanda (503 registros) ⭐                  │
│      │       ├── id_prediccion: 1-503                                      │
│      │       ├── valor_real_kg: [0-1000]                                   │
│      │       ├── valor_predicho_kg: [290-663]                              │
│      │       ├── error_mape: [0%-7103%]                                    │
│      │       └── ...                                                       │
│      │                                                                      │
│      ├── lstm\                                                            │
│      │   ├── predicciones_lstm.csv (archivo original)                      │
│      │   ├── analisis_predicciones_bd.csv (exportación)                    │
│      │   ├── test_insert_predictions_db.py (script inserción)              │
│      │   └── query_predictions_db.py (script consulta)                     │
│      │                                                                      │
│      ├── database\                                                        │
│      │   └── db.py (configuración SQLite/PostgreSQL)                       │
│      │                                                                      │
│      └── models\                                                          │
│          └── models.py (definición ORM)                                    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  VISTA ACTUAL (DESARROLLO - SQLite)                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   Aplicación FastAPI                                                        │
│   ↓                                                                         │
│   database/db.py → create_engine("sqlite:///./gestion_rutas.db")           │
│   ↓                                                                         │
│   models/models.py → Define ORM (Zona, PrediccionDemanda)                 │
│   ↓                                                                         │
│   ⭐ gestion_rutas.db ⭐ (Archivo SQLite local - 53 KB)                   │
│   │                                                                         │
│   ├── Tabla: zona (1 fila)                                                 │
│   └── Tabla: prediccion_demanda (503 filas)                                │
│                                                                              │
│   ACCESO A DATOS:                                                          │
│   • Python + SQLAlchemy ORM ✅                                             │
│   • FastAPI endpoints ✅                                                   │
│   • SQLite3 directo ✅                                                     │
│   • PostgreSQL → ⏳ (Pendiente)                                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  VISTA FUTURA (PRODUCCIÓN - PostgreSQL)                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   Aplicación FastAPI                                                        │
│   ↓                                                                         │
│   database/db.py → create_engine("postgresql://user:pass@host:5432/...")  │
│   ↓                                                                         │
│   models/models.py → Define ORM (igual)                                   │
│   ↓                                                                         │
│   ⭐ PostgreSQL Server ⭐                                                   │
│   │                                                                         │
│   ├── Base de datos: gestion_rutas                                         │
│   │   ├── Tabla: zona (1 fila)                                             │
│   │   └── Tabla: prediccion_demanda (503 filas)                            │
│   │                                                                         │
│   └── (Base de datos compartida, escalable, con respaldo)                  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

╔════════════════════════════════════════════════════════════════════════════╗
║                        📊 DATOS POR TABLA                                  ║
╚════════════════════════════════════════════════════════════════════════════╝

TABLA: zona
┌─────────┬──────────────────┬─────────┬──────────┬──────────┬──────────┐
│ id_zona │ nombre           │ tipo    │ area_km2 │ poblacion│ prioridad│
├─────────┼──────────────────┼─────────┼──────────┼──────────┼──────────┤
│    1    │ Zona Prueba LSTM │  test   │  50.0   │  5000   │    1    │
└─────────┴──────────────────┴─────────┴──────────┴──────────┴──────────┘

TABLA: prediccion_demanda (Primeros 3 de 503 registros)
┌──────────────┬─────────┬───────────┬─────────────────┬─────────┬──────────┬────────┬────────┬────────┐
│ id_prediccion│ id_zona │ horizonte │ fecha_prediccion│ real_kg │ pred_kg  │ modelo │ rmse   │ mape % │
├──────────────┼─────────┼───────────┼─────────────────┼─────────┼──────────┼────────┼────────┼────────┤
│      1       │    1    │    24     │ 2024-06-04...  │ 260.50  │ 535.06   │  1.0   │ 0.2746 │ 105.40 │
│      2       │    1    │    24     │ 2024-06-05...  │ 865.55  │ 501.88   │  1.0   │ 0.3637 │ 42.02  │
│      3       │    1    │    24     │ 2024-06-06...  │ 117.65  │ 578.47   │  1.0   │ 0.4608 │ 391.70 │
│     ...      │   ...   │   ...     │      ...        │  ...    │   ...    │  ...   │  ...   │  ...   │
│     503      │    1    │    24     │ 2024-10-19...  │ 756.30  │ 448.59   │  1.0   │ 0.3077 │ 40.69  │
└──────────────┴─────────┴───────────┴─────────────────┴─────────┴──────────┴────────┴────────┴────────┘

╔════════════════════════════════════════════════════════════════════════════╗
║                     🔍 COMO ACCEDER A LOS DATOS                           ║
╚════════════════════════════════════════════════════════════════════════════╝

1️⃣  DESDE FASTAPI (Recomendado):
   GET /lstm/metricas → Lee de prediccion_demanda
   POST /lstm/predecir → Consulta tabla prediccion_demanda
   GET /lstm/reporte → Analiza tabla prediccion_demanda

2️⃣  DESDE PYTHON SQLAlchemy:
   from models.models import PrediccionDemanda
   db.query(PrediccionDemanda).filter_by(id_zona=1).all()

3️⃣  DESDE SQLite CLI:
   sqlite3 gestion_rutas.db
   SELECT COUNT(*) FROM prediccion_demanda;

4️⃣  DESDE POSTGRESQL (Futuro):
   psql -U postgres -d gestion_rutas
   SELECT * FROM prediccion_demanda LIMIT 5;

╔════════════════════════════════════════════════════════════════════════════╗
║                      📌 INFORMACIÓN CLAVE                                  ║
╚════════════════════════════════════════════════════════════════════════════╝

UBICACIÓN DEL ARCHIVO:
  🗂️  c:\Users\hanss\Desktop\LAR\gestion_rutas\gestion_rutas.db

TAMAÑO:
  📊 53 KB (muy pequeño, ideal para desarrollo)

FORMATO:
  🗄️  SQLite 3 (base de datos embebida)

REGISTROS CARGADOS:
  ✅ 503 predicciones LSTM
  ✅ 1 zona de prueba
  ✅ Total: 504 filas

ESTADO:
  🟢 Datos listos para consultar
  🟢 Datos listos para migrar a PostgreSQL
  🟢 Datos validados y verificados

PRÓXIMOS PASOS:
  1. Consumir desde endpoints FastAPI
  2. Migrar a PostgreSQL (si es necesario)
  3. Agregar más datos de otros puntos de recolección
